{{#section 'css'}}
<style>
    .countdown {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 5px solid #000;
    }

    .img-question-wrapper {
        height: 400px;
        overflow: hidden;
        position: relative;
    }

    .img-question {
        height: 400px;
    }

    @media only screen and (max-width: 800px) {
        .countdown {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid #000;
        }

        .img-question-wrapper {
            height: 200px;
            overflow: hidden;
            position: relative;
        }

        .img-question {
            height: 200px;
        }
    }
</style>
{{/section}}

{{#section 'js'}}
<script>
    let answer = 0;
    let answerTime = 0;
    var start = Date.now();
    let player = JSON.parse(sessionStorage.getItem(`profile`));
    if(!player){
        disableAnswerBtn();
    }
        console.log(player);
    
    $("#ans1").click(() => {
        answer = 1;
        disableAnswerBtn();
        answerTime = getAnswerTime(start);
    });
    $("#ans2").click(() => {
        answer = 2;
        disableAnswerBtn();
        answerTime = getAnswerTime(start);
    });
    $("#ans3").click(() => {
        answer = 3;
        disableAnswerBtn();
        answerTime = getAnswerTime(start);
    });
    $("#ans4").click(() => {
        answer = 4;
        disableAnswerBtn();
        answerTime = getAnswerTime(start);
    });

    // Handle countdown
    var sec = 5
    $('#countdown').css({
        fontSize: 40
    });
    $('#countdown').css("font-weight", "bold");
    var timer = setInterval(function () {
        $('#countdown').text(sec--);
        if (sec < 10) {
            $('#countdown').addClass("text-warning");
            $('#countdown').addClass("text-success");
        }
        if (sec < 5) {
            $('#countdown').addClass("text-danger");
            $('#countdown').addClass("text-warning");
        }
        if (sec <= -1) {
            if(player){
                player.answer = answer;
                player.answerTime = answerTime;     
                sessionStorage.setItem(`profile`,JSON.stringify(player));
                socket.emit("thisIsMyAnswer",player,localStorage.getItem("correct_answer"));
            }else{
                // only host
                socket.emit("nextQuestion",window.localStorage.getItem("localPin"));
                console.log(window.localStorage.getItem("localPin"));
            }            
            $('#countdown').fadeOut('slow');
            clearInterval(timer);
            window.location.replace("/player/small-statistic");
        }
    }, 1000);

    function disableAnswerBtn() {
        $("#ans1").attr("disabled", true);
        $("#ans2").attr("disabled", true);
        $("#ans3").attr("disabled", true);
        $("#ans4").attr("disabled", true);
    }
    function getAnswerTime(start){
        return Math.floor((Date.now()-start)/1000);
    }
</script>
<script>
    // send get question command
    socket.emit("getQuestion", window.localStorage.getItem("localPin"));
    // Increase questionIndex
    let i = window.localStorage.getItem("questionIndex");
    // Get question content
    socket.on("question-content", (question) => {
        // Show question-content
        $('#question-content').html(question.question_content);
        localStorage.setItem("correct_answer",question.question_answercorrect);
        if (question.question_image !== '')
            $('#question-image').attr('src', '/img/' + question.question_image);
        $('#question-answer1').html(question.question_answer1);
        $('#question-answer2').html(question.question_answer2);
        $('#question-answer3').html(question.question_answer3);
        $('#question-answer4').html(question.question_answer4);
    })


</script>
{{/section}}

<div class="container p-5">
    {{!-- Question --}}
    <div class="d-flex justify-content-center bg-light rounded border border-dark">
        <h3 id="question-content"></h3>
    </div>

    <div class="row my-4">
        <div class="col-3 d-flex justify-content-center">
            <div class="countdown d-flex justify-content-center align-items-center">
                <h3 class="text-success" id="countdown">15</h3>
            </div>
        </div>
        <div class="col-9 img-question-wrapper d-flex justify-content-center">
            <img id="question-image" class="img-question img-fluid rounded" src="/img/question.gif" alt="Error" />
        </div>
    </div>

    {{!-- Answers --}}
    <div class="row d-flex justify-content-center mt-5">
        <div class="form-inline col-md-6 mb-3 row d-flex justify-content-center">
            <button id="ans1" class="btn btn-danger col-11 py-4 d-flex justify-content-start align-items-center">
                <span class="mr-4" style="font-size: 28px">A.</span>
                <span id="question-answer1" style="font-size: 24px"> </span>
            </button>
        </div>
        <div class="form-inline col-md-6 mb-3 row d-flex justify-content-center">
            <button id="ans2" class="btn btn-warning col-11 py-4 d-flex justify-content-start align-items-center">
                <span class="mr-4" style="font-size: 28px">B.</span>
                <span id="question-answer2" style="font-size: 24px"> </span>
            </button>
        </div>
        <div class="form-inline col-md-6 mb-3 row d-flex justify-content-center">
            <button id="ans3" class="btn btn-info col-11 py-4 d-flex justify-content-start align-items-center">
                <span class="mr-4" style="font-size: 28px">C.</span>
                <span id="question-answer3" style="font-size: 24px"> </span>
            </button>
        </div>
        <div class="form-inline col-md-6 mb-3 row d-flex justify-content-center">
            <button id="ans4" class="btn btn-success col-11 py-4 d-flex justify-content-start align-items-center">
                <span class="mr-4" style="font-size: 28px">D.</span>
                <span id="question-answer4" style="font-size: 24px"> </span>
            </button>
        </div>
    </div>
</div>